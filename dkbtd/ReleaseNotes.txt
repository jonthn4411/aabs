==============================================================================
Marvell PXA920 Android Platform Release for Linux 
Platform README 
Last update: 04/27/2010
==============================================================================

1. Platform features
1.1 Supported Components
- Rebase to google android eclair 2.1_r2 branch
- Do key pad mapping, touch for PXA920 DKB platform
- HIFI playback on headset and speaker
- Audio routing for phone earpiece and headset
- Audio recorder for built-in Mic and headset Mic
- Camera preview and still image capture by OV3640 
- Integrate OpenGL ES 1.1 and OpenGL ES 2.0 with GC500
- Integrate IPP c&M H.264 decoder for media player
- Integrate IPP AAC version decoder for media player
- Integrate IPP MP3 version decoder for media player
- Integrate Marvell RIL and telephony baseband
  - Support 2G vioce call and data call
  - Support 3G vioce call on DKB board
  - Support SMS/MMS
  - Support STK
  - Support Modem function
  - Support DIAG
  - Support SS/USSD

1.2 BSP features
Uboot
- Boot from Nand/Onenand
- Download from USB ethernet
- Burn image into Nand/Onenand
- Flash Bad block management
- Boot kernel with kernel command line
- Voltage/Frequency change
Linux-2.6.29
- MTD devices
  - Support Nand
  - Support Onenand
  - Support Fash Bad block management
  - Support JFSS2
  - Support YAFFS
  - Support Partition
- WMMX
  - Support context switch
- IMM
  - SRAM is maintained by IMM. (audio driver occupy all the SRAM maintained by IMM.)
- Power Management
  - Support chip sleep
  - Support chip idle
  - Support core idle
  - Support to use Keypad to wake up system
  - Support to use RTC to wake up system
  - Support to switch OP by "echo" command to sysfs
  - Support dynamic frequenc and voltage change base on power policy maker in kernel. 
- LCD (Dump panel)
  - Support base display
  - Support overlay display
  - Support scaling
  - Support backlight control
  - Support FB interface
  - Support pan display
  - Support HVGA resolution display
  - Support RGB565, RGB888Packed, RGB888Unpacked, YUV420planar, YUV422planar and YUV422Packed format. 
- IRE
  - Support YUV420 90 degree clockwise rotation
- Camera (CCIC)
  - Support V4L2 interface
  - Support Parallel and MIPI interface.
  - Support JPEG format
  - Support YUV420Planar, YUV422Planar and YUV422Packed format. 
  - Support to accept framebuf from user application.
- OV3640
  - Support to config pixel format
  - Support to switch image/video mode 
  - Support still image with QVGA and VGA resolution. HVGA and 3M resolutions still have problems. 
  - Support video with QVGA, VGA and HVGA resolution. 3M resolution still has problem. 
- SSP
  - Support to config it as I2S to transfer audio PCM data to outside code. 
- Audio (use levante as outside audio codec)
  - Support ALSA interface
  - Support to playback Audio
  - Support to Recodrd Audio 
  - Support to playback and record simultaneously. (The codec native sample rate will locked as 48K for both playback and record. And the alsa lib will handle the sample rate conversion automaitically)
  - Support 2.5mm Jack
  - Support headset and MICIN detection. (The audio server application will setup the audio path base on the detection event automatically)
  - Support on-board mic
- Touch screen (ELAN and TPO touch)
  - Support pen attach, move, detach and time stamp. 
- Keypad
  - Support Key down, up, repeat and time stamp. 
- I2C (two i2c busses)
  - Share/Arbitrate the busses for multi devies.
  - Support RIPC to share the bus with other CPUs.
- UART (FFUART, BTUART)
  - Support tty interface
  - Support tty console
  - Support multi sample rate
  - Support HW flaw control
  - Support both DMA and PIO modes
- USB
  - Host
    - Support to access USB mass storage device
    - Support hot plug-in and remove
    - Support USB hub
  - OTG
    - Support dual role device
    - HNP and SRP are NOT support
  - Client
    - Support ethernet, mass storage, adb and diag drivers.
    - Support composite devie.
    - Support hot attach and detach
- MMC/SD
  - MMC4.3/SD2.0
    - Support partition
    - Support hot plug-in and remove
    - Support lock and unlock
    - Support write protect switch
  - SDIO
    - Support WiFi SDIO card
- WLAN
  - Support SD8787
  - Support WPA 
- BT
  - Support SD8787
  - Support A2DP profile (BT on UART is not support. Only SDIO interface is enabled. )
- Power supply
  - Support battery capacity measurement. (it is not accurate.)
  - Support USB supply
  - Support USB charging
  - Support poweroff. (NOTE: if the system is not poweroff normally, the next boot time will be longer for the filesystem scan. )
  - Support reboot. 
- Sensors
  - g sensor (lis3lv02d)
- MISC

1.3 Telephony
- Msocket(shared memory + ACIPC)	
	- Share memory mechanism(2 ring buffer)
	- Handshake mechanism(ACIPC)
	- Port flow control
	- Ring buffer flow control
	- send/receive Msocket data
	- Msocket Priority control
- DIAG	
	- ACAT-Diag over USB
	- ACAT-Diag over SD card
	- ACAT-AT commands through Diag
- EEH(Error handler)	       
	- Report
- NVM	
	- Flasher explorer support for AP/CP
	- FDI(Read/Write/Open/Close files)
- Modem	
	- Modem over USB 
	- Modem and Diag USB Composite
- Network Service related	
	- GSM/WCDMA Network
	    - automatic register/deregister
	    - manual register/deregister
	- GPRS/EDGE/WCDMA
	    - automatic attach/detach
	    - manual attach/detach
	- RAT selection
			- 2G only
			- 3G only
- Voice Call related	
	- Call Control for 2G/3G
	    - MO call
	    - MT call
	    - DTMF
	    - Emergency call
	    - Call Mute (Near end Mute) 
	    - Voice Volume Control
	    - PS Data Call and Voice Call Simultaneously
	- Call Control related Supplentary Service for 2G/3G
	    - multiparty call 
	    - call holding
	    - call waiting
	    - call forwarding
	   - Call Transfer on busy/ on reply/Not reachable/unconditional
	   - Explicit Call Transfer for an Active Call and a Held Call
	   - Caller ID presentation
	   - Called ID presentation
	   - Restrict caller address info shown on called party
	   - Restrict called address info shown on calling party
	   - Call Barring
	     - incoming call barring
	     - outgoing call barring
	     - change call barring password
- Audio	
	- Audio server
	   - HIFI:
	      - Playback
	      - Recording
	      - Simultaneous playback and recording
	      - Change playback volume
	      - Mute playback
	   - Headset Detection
	   - Bluetooth
	      - BT A2DP music playback
	      - BT headset incoming call and outgoing call
	- ACM
	  - ACM data path
	   - Mix Audio to far end while making Phone Call
	   - Recording Phone Call (both far end and near end)
	  - ACM control path
	   - Audio input/output route for voice (handset, earpiece, speaker, BT)
	   - Audio input/output route for HiFi playback (handset, speaker, BT)
- Data Call related	
	- PSD Data Call 
	  - Connection Establish (DirectIP)
	  - Disconnect (DirectIP)
	  - Connection Establish (PPP)
	  - Disconnect (PPP)
	- CSD Data Call
	  - CSD 64K
- SMS/MMS related	
	- SMS related
	  - Write SMS to Message storage
	  - Delete SMS Message from Message Storage
	  - Send Message
	  - Send Message from message storage
	  - Read SMS from Message storage
	  - Set Message storage
	  - Set/Read SMS Center address 
	  - Query Used memory storages
	  - Set Preferred Message Storage
	  - SMS full notification(msg storage status indication)
	  - Bearer Choose GPRS and GSM
	  - Receive Message
	- MMS related
	  - Send MMS
	  - Receive MMS
- PhoneBook related	
	  - read PB entry from SIM
	  - write PB entry from SIM
	  - delete PB entry from SIM
	  - query PB entry from SIM
	  - set PB storage
	  - read PB entry from ME
	  - write PB entry from ME
	  - delete PB entry from ME
	  - query PB entry from ME
- STK related	
	  - Display menu
	  - Display information
	  - Send SMS
	  - Make voice call

1.4 Release package contents
- ReleaseNotes.txt                                   :This readme.txt(include how to setup Android dir,build and burn flash)
- PXA920_Android_Platform_Beta2_prebuilt_bin.zip     :Pre-built bin binaries
- PXA920_Android_Platform_Beta2_src.tgz00            :Source code tarball (patch mode),part1
- PXA920_Android_Platform_Beta2_src.tgz01            :Source code tarball (patch mode),part2
  - setup_android.sh                                 :Script help to setup Android code base
  - android_patches.tgz                              :Marvell patches to Android Projects
  - android_src.tgz                                  :Source code for projects added by Marvell
  - marvell_manifest.xml                             :Manifest xml file to download Android eclair as a base
  - kernel_patches.tgz                               :Marvell patches to kernel_src.tgz 
  - kernel_src.tgz                                   :Kernel base source code
  - uboot_patches.tgz                                :Marvell patches to uboot_src.tgz
  - uboot_src.tgz                                    :Uboot base source code
  - obm_src.tgz                                      :OBM source code
- SWD_GUI_2.0_RC4_linux.zip                          :Software downloader

2. System Requirements
2.1 Hardware requirements
- OneNAND flash 256-MB large block
- DDR SDRAM 256 MB
- PXA920 DKB Board
  - Debug board: TD_DKB_DEBUG PCB070110 REV3.0 
  - Core board: TD_DKB_CORE PCB240210 REV3.01
  - RF board: TD_DKB_RF REV3.0
  - MMI board: TD_DKB_MMI PCB170709 REV1.0 / TD_DKB_MMI PCB240909 REV2.0

2.2 Software requirements
- Host PC with operating system Ubuntu 6.06 or above

3. Usage of this package 
3.1 Install this package
3.1.1 Download the Marvell packages:
----PXA920_Android_Platform_Beta2_src.tgz00
----PXA920_Android_Platform_Beta2_src.tgz01
----PXA920_Android_Platform_Beta2_prebuilt_bin.zip
 $ cat PXA920_Android_Platform_Beta2_src.tgz00 PXA920_Android_Platform_Beta2_src.tgz01 > PXA920_Android_Platform_Beta2_src.tgz
3.1.2 Type the following command to install:
 $ mkdir [installed_directory]
 $ cd [installed_directory]
 $ tar -xvzf [The PATH you downloaded Marvell Packages]/PXA920_Android_Platform_Beta2_src.tgz

3.2 Setup Android directory
 $ mkdir [android_dir]
 $ cd [android_dir]
 $ repo init -u git://android.git.kernel.org/platform/manifest -b master
 $ cp [installed_directory]/src/marvell_manifest.xml .repo/manifests/
 $ repo init -m marvell_manifest.xml
 $ repo sync
 $ cd [installed_directory]/src
 $ ./setup_android.sh [android_dir]

3.3 Building Android,Linux Kernel,Uboot

3.3.1 Build Linux Kernel
 $ cd [android_dir]/kernel
 $ make kernel
After a short while, the binaries will be generated under [android]/kernel/out/zImage

3.3.2 Build Modules
 $ cd [android_dir]/kernel
 $ make modules
Note: Please make kernel before making modules
After a short while, the binaries will be generated under [android]/kernel/out/modules

3.3.3 Buid PXA Android by:
 $ cd [android_dir]
 $ . build/envsetup.sh
 $ chooseproduct dkbtd
 $ export ANDROID_PREBUILT_MODULES=[android_dir]/kernel/out/modules
 $ make -j4
Note : If there is no modules, Please export ANDROID_PREBUILT_MODULES=no_kernel_modules
After a while (30~60 minutes), the binaries will be generated under [android_dir]/out/target/product/dkbtd/.
Note: Currently we use Android default toolchain version: arm-eabi-4.2.1 to compile Android, kernel and telephony. After you run choosecombo, you can check your PATH setting and make sure it has included the path for arm-eabi-4.2.1. Please don¡¯t specify other android toolchain version. 

3.3.4 Building telephony
 $ cd [android_dir]/kernel
 $ make telephony
Note: Please make android before making telephony
After a short while, the binary will be generated under [android]/kernel/out/telephony/pxafs.img

3.3.5 Building uboot
 $ cd [android_dir]/boot
 $ make uboot
After a short while, the binary will be generated under [android]/boot/out/u-boot.bin

3.3.6 Building obm
 $ cd [android_dir]/boot
 $ make obm
After a short while, the binary and configuration will be generated under [android]/boot/out/SWD_GUI_2.0
You can copy all the files to overwrite [SW_Downloader_Dir] on the host PC.


3.4 Flashing images and boot system (256MB is set as default)
3.4.1 CP version
        TD Beta2                       --> TVRTD_CP01.06.014
3.4.2 Burn following binaries to flash by using Software Downloader. Please see <TVTD_DKB3_0_SWDownloader_GUI_User_Guide.doc>.
1)       Please check your board, if the nand ID is JY504 (CS1), you can choose the configuration file:
TVTD_DKB3_0_Linux_JY504_JY454.blf
2)       Otherwise, if the nand ID is JY345(CS2), you can choose the configuration file:
TVTD_DKB3_0_Linux_JW345.blf

        TVTD_DKB3_0_Loader_3_2_13_LINUX.bin  	                --> flash address 0x20000
        u-boot.bin                      			--> flash address 0x40000
        ramdisk.img                     			--> flash address 0xc0000 [ramdisk_no_gui.img --> flash address 0xc0000: used for audio/RF calibration]
        reliabledata_trusted.rnd        			--> flash address 0x100000
        Arbel.bin                       			--> flash address 0x120000
        TTC1_M06_AI_A0_Flash.bin        			--> flash address 0x820000
        zImage							--> flash address 0x920000
        system.img						--> flash address 0xc20000
        userdata.img						--> flash address 0x7c20000
        pxafs.img						--> flash address 0xec20000

4.0 Known issues and workarounds
GC500 issue while resume.(it will block the chip sleep feature)

----------------------------

---------------------------------------------------------------------
Disclaimer and Legal Information:
---------------------------------------------------------------------
No part of this document may be reproduced or transmitted in any 
form or by any means, electronic or mechanical, including 
photocopying and recording, for any purpose, without the express 
written permission of Marvell. Marvell retains the right to make 
changes to this document at any time, without notice. Marvell makes 
no warranty of any kind, expressed or implied, with regard to any 
information contained in this document, including, but not limited 
to, the implied warranties of merchantability or fitness for any 
particular purpose. Further, Marvell does not warrant the accuracy 
or completeness of the information, text, graphics, or other items 
contained within this document.
 
Marvell products are not designed for use in life-support equipment 
or applications that would cause a life-threatening situation if 
any such products failed. Do not use Marvell products in these 
types of equipment or applications.
 
With respect to the products described herein, the user or 
recipient, in the absence of appropriate U.S. government 
authorization, agrees:
 
1) Not to re-export or release any such information consisting of 
technology, software or source code controlled for national 
security reasons by the U.S. Export Control Regulations ("EAR"), 
to a national of EAR Country Groups D:1 or E:2;
 
2) Not to export the direct product of such technology or such 
software, to EAR Country Groups D:1 or E:2, if such technology or 
software and direct products thereof are controlled for national 
security reasons by the EAR; and,
 
3) In the case of technology controlled for national security 
reasons under the EAR where the direct product of the technology 
is a complete plant or component of a plant, not to export to 
EAR Country Groups D:1 or E:2 the direct product of the plant or 
major component thereof, if such direct product is controlled for 
national security reasons by the EAR, or is subject to controls 
under the U.S. Munitions List ("USML").
 
At all times hereunder, the recipient of any such information 
agrees that they shall be deemed to have manually signed this 
document in connection with their receipt of any such information.
 
Copyright (C) 2008. Marvell International Ltd. All rights reserved. 
Marvell, the Marvell logo, Moving Forward Faster, Alaska, 
AnyVoltage, CODECHANNEL, Fastwriter, Datacom Systems on Silicon, 
DSP Switcher, Feroceon, GalNet, INTERPRINT, Libertas, Link Street, 
MOBILEPRINT, NetGX, PHYAdvantage, Prestera, Raising The Technology 
Bar, SUPERPRINT, SUPERQUEUE, The Technology Within, Virtual Cable 
Tester, Yukon, ZJ, ZSCRIPT, ZX, and ZXSTREAM are registered 
trademarks of Marvell. Ants,  Discovery, GalTis, Horizon, Marvell 
Makes It All Possible, RADLAN, UniMAC, and VCT are trademarks of 
Marvell.

All other trademarks are the property of their respective 
owners.

Marvell Semiconductor, Inc.
5488 Marvell Lane
Santa Clara, CA 95054, USA
Tel: 1.408.222.2500
Fax: 1.408.752.9028
Email: commsales@marvell.com


